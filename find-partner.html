<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles-head1.css">
    <link rel="icon" href="icon/inlover.png" type="image/png">
    <title>Find partner</title>
    <script>
        // ตรวจสอบสถานะการล็อกอินโดยอ่านค่าจาก Local Storage
        var isLoggedIn = localStorage.getItem('isLoggedIn');
        console.log(isLoggedIn);
        // ถ้ายังไม่ได้ล็อกอิน ให้เปลี่ยนเส้นทางไปยังหน้า login.html
        if (isLoggedIn === 'false') {
            window.location.href = 'login.html';
        }else if (isLoggedIn === null || isLoggedIn === undefined || isLoggedIn === ''){
            window.location.href = 'login.html';
        }
        
    </script>
    <style>
body {
font-family: Arial, sans-serif;
height: 100%;
margin: 0;
width: 100%
}
.card-all{
    /* background-color: black; */
    width: 100%;
    height: 100vh;
    margin: 0;
    padding: 0;

}
.card-history{
    width: 15rem;
    height: 80vh;
    /* background-color: #674545; */
    display: flex;
    flex-wrap: wrap;
    top: 47%;
    left: 87%;
    transform: translate(-50%, -50%);
    position: fixed;
    margin: 0;
    z-index: 1;
}
.history a{
    text-decoration: none;
}
.history h1{
    margin: 0.5rem;
}
.history img{
    width: 2.5rem;
}
.history .icon-img{
    /* background-color: white; */
    background: rgb(255, 255, 255, 0.5);
    border-radius: 1rem;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    margin: 0.5rem
}
.history .icon-img:hover{
    opacity: 0.6;
}
.history .icon-img h3{
    margin-left: 0.5rem;
}
.card-container {
    /* background-color: #ffffff; */
    display: flex;
    flex-wrap: wrap;
    gap: 20px; /* ให้การ์ดไม่ซ้อนกัน */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    position: fixed;
    margin: 0;
    z-index: 2;
}

.card {
    margin-top: 0;
    background-color: aliceblue;
    border-radius: 1rem;
    text-align: center;
    width: 20rem;
    height: 30rem;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: -2;
    overflow: hidden;
}
.card-img{
    width: 20rem;
    height: 24rem;
    overflow: hidden;
}

.card-container p{
    margin: 0.3rem;
    padding: 0;
    font-size: 1.6rem;
}

.card img {
    max-width: 100%;
    /* max-height: 18rem; */
    
}

.buttons {
    margin-top: 0;
}

.like-btn,
.save-btn,
.dislike-btn {
    font-size: 0.8rem;
    border-radius: 4px;
    height: 3rem;
    font-weight: 600;
    text-transform: uppercase;
    -webkit-transition: all 200ms linear;
    transition: all 200ms linear;
    padding: 0 20px;
    letter-spacing: 1px;
    display: -webkit-inline-flex;
    display: -ms-inline-flexbox;
    display: inline-flex;
    align-items: center;
    background-color: #ffeba7;
    color: #000000;
}

.like-btn:hover{
    background-color: #ffa7a7;
    color: #000000;
    /* box-shadow: 0 8px 24px 0 rgba(16, 39, 112, .2); */
}
.save-btn:hover{
    background-color: #a7e8ff;
    color: #000000;
    /* box-shadow: 0 8px 24px 0 rgba(16, 39, 112, .2); */
}
.dislike-btn:hover{
    background-color: #b3b8b4;
    color: #000000;
    /* box-shadow: 0 8px 24px 0 rgba(16, 39, 112, .2); */
}


/* ส่วนของการ์ดที่แสดงผลตอนแมท */

.card-container-like {
    background-color:  #c3cff4;
    border: none;
    border-radius: 1rem;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1; /* ค่า z-index สูงสุดเพื่อให้ชั้นนี้อยู่ด้านบนสุด */
    display: flex;
    flex-direction: row;
    justify-content: center;
}
.card-container-like::before{
    display: block;
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: linear-gradient(45deg, #c3cff4, #fafafa,#c3cff4,#F6C8B6);
    background-size: 200% 200%;
    animation: gradientAnimation 15s ease infinite;
    margin: 0;
    padding: 0;
    border-radius: 1rem;
}

.card-show-match {
    border: 1px solid #ddd;
    /* padding: 10px; */
    width: 20rem;
    height: 30rem;
    text-align: center;
}

.card-img-match{
    width: 20rem;
    height: 24rem;
    overflow: hidden;
}
.card-img-match img{
    max-width: 100%;
    height: auto;
}

.name-user {
    /* สไตล์ของชื่อผู้ใช้ (เพิ่มหากต้องการ) */
}

/* หัวใจ ********************************/
.heart {
    /* position: absolute; */
    width: 100px;
    height: 90px;
    animation: float 2s infinite ease-in-out;
}

.heart::before,
.heart::after {
    position: absolute;
    content: '';
    left: 50px;/* left: 50px; */
    width: 50px;/* width: 50px; */
    height: 80px;/* height: 80px; */
    background: #ff3333;
    border-radius: 50px 50px 0 0;
    transform: rotate(-45deg);
    transform-origin: 0 100%;
}
.heart::after {
    left: 0;
    transform: rotate(45deg);
    transform-origin: 100% 100%;
}

.heart:nth-child(1) {
    transform: scale(1);
    animation: pulsate 2s infinite ease-in-out;
}

.heart:nth-child(2) {
    animation-delay: 1s;
}

.heart:nth-child(3) {
    animation-delay: 1.4s;
}

.heart:nth-child(4) {
    animation-delay: 1.8s;
}
.heart:nth-child(5) {
    animation-delay: 2.2s;
}
.heart:nth-child(6) {
    animation-delay: 2.6s;
}

@keyframes pulsate {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.3);
    }
    100% {
        transform: scale(1);
    }
}

@keyframes float {
    from {
        transform: translateY(0px) scale(0.7) rotate(0deg);
        opacity: 0.6;
    }
    to {
        transform: translateY(-250px) scale(0.3) rotate(360deg);
        opacity: 0;
    }
}


.container-heart {
    position: relative;
    height: 100%;
}

/* ตัวที่แสดงตอนคลิ๊กที่รูปภาพ */
.card-container-profile {
    background-color:  #c3cff4;
    border: none;
    border-radius: 1rem;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1; /* ค่า z-index สูงสุดเพื่อให้ชั้นนี้อยู่ด้านบนสุด */
    display: flex;
    flex-direction: row;
    justify-content: center;
    gap: 20px; /* ระยะห่างระหว่างการ์ด */
}
.card-container-profile::before{
    display: block;
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: linear-gradient(45deg, #c3cff4, #fafafa,#c3cff4,#F6C8B6);
    background-size: 200% 200%;
    animation: gradientAnimation 15s ease infinite;
    margin: 0;
    padding: 0;
    border-radius: 1rem;
}

.card-show-profile {
    display: flex;
    border: 1px solid #ddd;
    padding: 10px;
}
/* ปุ่มปิด */
.close-profile {
    width: 2.5rem;
    position: absolute; /* ตั้งค่า position เป็น absolute เพื่อให้ภาพ close อยู่ตรงกับตำแหน่งที่กำหนด */
    top: -10px; /* ตั้งค่า top เป็น 0 เพื่อให้ภาพ close อยู่ที่ด้านบนของ container */
    right: -10px; /* ตั้งค่า right เป็น 0 เพื่อให้ภาพ close อยู่ที่ด้านขวาของ container */
    cursor: pointer; /* เพิ่ม cursor pointer เพื่อให้ผู้ใช้รู้ว่าสามารถคลิกได้ */
}
.close-profile:hover{
    opacity: 0.6;
    width: 2.7rem;
}
.card-img-profile{
    width: 22rem;
    height: 30rem;
    border-radius: 1rem;
    overflow: hidden;
}
.card-img-profile img{
    width: 100%;
    height: auto;
}
.user-data{
    width: 15rem;
    padding-left: 1rem;
}
.user-data h3{
    font-size: 1.5rem;
    padding-bottom: 0.5rem;
}
.user-data p{
    padding: 0.1rem 0rem;
    font-size: 1.2rem;
}
.name-user {
    
}
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="information.html">
            <div id="profile">
                <!-- Change the src to the URL of the person icon -->
            </div>
        </a>
        <ul class="menu">
            <span>Menu</span>
            <li>
                <a href="information.html">
                    <ion-icon name="person-outline"></ion-icon>
                    <p>Profile</p>
                </a>
            </li>
            <li>
                <a href="dashboard.html">
                    <ion-icon name="home-outline"></ion-icon>
                    <p>Dashboard</p>
                </a>
            </li>
            <li class="likes">
                <a href="find-partner.html">
                    <ion-icon name="people-outline"></ion-icon>
                    <p>Find Partner</p>
                </a>
            </li>
            <li class="likes">
                <a href="like-chat.html">
                    <ion-icon name="chatbox-outline"></ion-icon>
                    <p>Chat</p>
                </a>
            </li>
            <li>
                <a href="chat-admin.html">
                    <ion-icon name="headset-outline"></ion-icon>
                    <p>Contact Admin</p>
                </a>
            </li>
            <li>
                <a href="logout.php">
                    <ion-icon name="log-out-outline"></ion-icon>
                    <p>Logout</p>
                </a>
            </li>
        </ul>   
    </div>
    <!-- Ionicons -->
    <script
        type="module"
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script
        nomodule
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Add the script to use Ionicons through CDN -->
    <script
        type="module"
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script
        nomodule
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>
let containerDiv = document.getElementById('profile');
    fetch('match-img-myself.php')
        .then(response => response.json())
        .then(data1 => {
            data1.forEach(item1 => {
                const card_like = document.createElement('div');
                card_like.classList.add('card-show');
                card_like.innerHTML = `
                    <div class="img-profile">
                        <img src="uploads/${item1.image_path || 'profile_none.png'}" alt="${item1.user_name}">
                    </div>
                    <p>${item1.user_name}</p>
                `;
                containerDiv.appendChild(card_like);
                // Append the created card to the DOM or perform any other necessary actions
            });
        })
        .catch(error => {
            console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
        });
    </script>
    <section class="card-history" >
        <div class="history">
            <h1>Click history</h1>
            <a href="history-like.html">
                <div class="icon-img">
                    <img src="icon/like.png" alt="">
                    <h3>like</h3>
                </div>
            </a>
            <a href="history-dislike.html">
                <div class="icon-img">
                    <img src="icon/dislike.png" alt="">
                    <h3>dislike</h3>
                </div>
            </a>
            <a href="history-save.html">
                <div class="icon-img">
                    <img src="icon/bookmark.png" alt="">
                    <h3>bookmark</h3>
                </div>
            </a>
            <a href="history-match.html">
                <div class="icon-img">
                    <img src="icon/two-hearts.png" alt="">
                    <h3>match</h3>
                </div>
            </a>
            
        </div>
    </section>
    <script src="find-new.js"></script>
    <section class="card-all" >
        <div class="card-container" id="card-container">
            <!-- การ์ดจะถูกสร้างโดย JavaScript -->
        </div>
    </section>
    <section class="information-user">
        <div class="infor-user">

        </div>
    </section>
    <!-- <script src="find-new.js"></script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cardContainer = document.getElementById('card-container');
            
            fetch('find-partner.php')
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        const card = document.createElement('div');
                        card.classList.add('card');
                        card.innerHTML = `
                            <div class="card-img">
                                <img src="uploads/${item.image_path}" alt="${item.user_name}">
                            </div>
                            <p>${item.user_name}</p>
                            <div class="buttons">
                                <button class="like-btn" type="submit" name="">Like</button>
                                <button class="save-btn" type="button" name="">save</button>
                                <button class="dislike-btn">Dislike</button>
                            </div>
                        `;

                        cardContainer.appendChild(card);
                        const cardImg = card.querySelector('.card-img');
                        const likeBtn = card.querySelector('.like-btn');
                        const saveBtn = card.querySelector('.save-btn');
                        const dislikeBtn = card.querySelector('.dislike-btn');
                        // let userLike = item.user_id;
//บันทึกข้อมูลผู้ใช้ที่ชอบ
                        function sendUserIdToInsertLike(userId) {
                            // ส่งค่า userId ไปที่ insert.php ทำการแก้ไข URL ตามที่ต้องการ
                            fetch(`match_like_insert.php?user_id=${userId}`, {
                                method: 'GET'
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                return response.text();
                            })
                            .then(data => {
                                // ทำสิ่งที่คุณต้องการหลังจากส่งข้อมูลไปที่ match_like_insert.php
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }

          //การ์ดโชว์ข้อมูลคนที่สนใจ
                        function showPopupProfile() {
                            let containerDiv = document.createElement('div');
                            containerDiv.classList.add('card-container-profile');
                            const card_me = document.createElement('div');
                            card_me.classList.add('card-show-profile');
                            card_me.innerHTML = `
                                <div class="card-img-profile">
                                    <img src="uploads/${item.image_path}" alt="${item.user_name}">
                                </div>
                                <div class="user-data">
                                    <h3>ชื่อ ${item.user_name}</h3>
                                    <p>อายุ ${item.age} ปี</p>
                                    <p>เพศ ${item.gender}</p>
                                    <p>น้ำหนัก ${item.weight_us}</p>
                                    <p>ส่วนสูง ${item.height}</p>
                                </div>
                                <img class="close-profile" src="icon/cancel.png" alt="Close">
                            `;
                            containerDiv.appendChild(card_me);
                            cardContainer.appendChild(containerDiv);

                            var closeButton = document.querySelector(".close-profile");
                            //ปิดหน้านี้
                            closeButton.addEventListener("click", function() {
                                // เลือก containerDiv โดยใช้ parentElement ของปุ่ม "close"
                                var containerDiv = closeButton.parentElement;
                                // ลบ containerDiv ออกจาก DOM
                                containerDiv.remove();
                            });
                        }

          //การ์ดที่โชว์ตอนแมท
                        function showPopup() {
                            let containerDiv = document.createElement('div');
                                // document.getElementById('popupMessage').innerText = message;
                                containerDiv.classList.add('card-container-like');
                                const card_me = document.createElement('div');
                                card_me.classList.add('card-show-match');
                                card_me.innerHTML = `
                                    <div class="card-img-match">
                                        <img src="uploads/${item.image_path}" alt="${item.user_name}">
                                    </div>
                                    <p class="name-user">${item.user_name}</p>
                                `;
                                containerDiv.appendChild(card_me);

                                fetch('match-img-myself.php')
                                .then(response => response.json())
                                .then(data1 => {
                                    data1.forEach(item1 => {
                                        const card_like = document.createElement('div');
                                        card_like.classList.add('card-show-match');
                                        card_like.innerHTML = `
                                            <div class="card-img-match">
                                                <img src="uploads/${item1.image_path}" alt="${item1.user_name}">
                                            </div>
                                            <p>${item1.user_name}</p>
                                        `;
                                        containerDiv.appendChild(card_like);
                                        
                                        // Append the created card to the DOM or perform any other necessary actions
                                    });
                                })
                                .catch(error => {
                                    console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
                                });

                                //สร้างหัวใจออกมา
                                let heartDiv = document.createElement('div');
                                heartDiv.innerHTML = `
                                    <div class="heart"></div>
                                    <div class="heart"></div>
                                    <div class="heart"></div>
                                    <div class="heart"></div>
                                `;
                                containerDiv.appendChild(heartDiv);

                                cardContainer.appendChild(containerDiv);
                                
                            setTimeout(() => {
                                    containerDiv.remove();
                                }, 10000); //5000 มีแสดงถึง 5 วินาที
                        }

                        // ฟังก์ชันเพื่อดึงข้อมูลจาก MySQL และแสดง Popup ครั้งแรก
                        function fetchDataAndShowPopup() {
                            // ทำการเรียก Fetch API หรือ AJAX เพื่อดึงข้อมูลจาก PHP
                            fetch('match-like-show.php')
                                .then(response => response.json())
                                .then(data1 => {
                                    // ตรวจสอบว่ามีข้อมูลหรือไม่
                                    if (data1.length > 0) {
                                        // แสดง Popup พร้อมข้อมูลที่ดึงมา
                                        console.log('มีข้อมูล');
                                        showPopup();
                                        // บันทึกข้อมูลการแมท
                                        fetch('match-like-save.php')
                                            .then(response => response.json())
                                            .then(data2 => {
                                                // ตรวจสอบว่ามีข้อมูลหรือไม่
                                                if (data2.length > 0) {
                                                    // แสดง Popup พร้อมข้อมูลที่ดึงมา
                                                    console.log('มีข้อมูล');
                                                    // console.log('มีข้อมูล');
                                                } else {
                                                    // ถ้าไม่มีข้อมูล
                                                    console.log('ไม่พบข้อมูล');
                                                }
                                            })
                                            .catch(error => {
                                                console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
                                            });
                                        // console.log('มีข้อมูล');
                                    } else {
                                        // ถ้าไม่มีข้อมูล
                                        // showPopup('ไม่พบข้อมูล');
                                        console.log('ไม่พบข้อมูล');
                                    }
                                })
                                .catch(error => {
                                    console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
                                });
                        }

//like บันทึกข้อมูลผู้ใช้เอาไว้
                        function sendUserIdToInsertSave(userId) {
                            // ส่งค่า userId ไปที่ insert.php ทำการแก้ไข URL ตามที่ต้องการ
                            fetch(`match_save_insert.php?user_id=${userId}`, {
                                method: 'GET'
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                return response.text();
                            })
                            .then(data => {
                                // ทำสิ่งที่คุณต้องการหลังจากส่งข้อมูลไปที่ match_like_insert.php
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }
//save บันทึกข้อมูลผู้ใช้ที่ไม่ชอบ
                        function sendUserIdToInsertDisLike(userId) {
                            // ส่งค่า userId ไปที่ insert.php ทำการแก้ไข URL ตามที่ต้องการ
                            fetch(`match_dislike_insert.php?user_id=${userId}`, {
                                method: 'GET'
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                return response.text();
                            })
                            .then(data => {
                                // ทำสิ่งที่คุณต้องการหลังจากส่งข้อมูลไปที่ match_like_insert.php
                                console.log(data);
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }
//dislike ส่วนที่ประกาศฟังก์ชันปุ่มต่างๆ
                        cardImg.addEventListener('click', function(){
                            showPopupProfile()
                        });
                        likeBtn.addEventListener('click', function () {
                            sendUserIdToInsertLike(item.user_id);
                            fetchDataAndShowPopup();
                            card.style.display = 'none';
                        });

                        //ส่วนของปุ่มบันทึกข้อมูล
                        saveBtn.addEventListener('click', function (){
                            sendUserIdToInsertSave(item.user_id);
                            card.style.display = 'none';
                        });

                        dislikeBtn.addEventListener('click', function () {
                            sendUserIdToInsertDisLike(item.user_id);
                            card.style.display = 'none';
                            //window.location.href = `match-duo.php?action=dislike&cardId=${item.cardId}`;

                        });                
                    });
                })
                .catch(error => console.error('Error:', error));
            });
    </script>
</body>
</html>