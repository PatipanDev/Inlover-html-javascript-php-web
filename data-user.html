<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data User</title>
    <link rel="stylesheet" href="styles-head1.css">
    <link rel="icon" href="icon/inlover.png" type="image/png">
    <script>
        // เมื่อหน้าเว็บโหลดเสร็จ
        var isLoggedIn = localStorage.getItem('isLoggedIn');
        console.log(isLoggedIn);
        // ถ้ายังไม่ได้ล็อกอิน ให้เปลี่ยนเส้นทางไปยังหน้า login.html
        if (isLoggedIn === 'false') {
            window.location.href = 'login.html';
        }else if (isLoggedIn === null || isLoggedIn === undefined || isLoggedIn === ''){
            window.location.href = 'login.html';
        }
    </script>
    <style>
.search{
    padding-left: 100px;
    
}
.search input{
    padding: 0.5rem;
    margin: 0.5rem;
    font-size: 1rem;
}
.search button{
    padding: 0.5rem;
    /* margin: 0.5rem; */
    font-size: 1rem;
}

#card-container {
    /* background-color: #c3cff4; */
    display: flex;
    flex-direction: column-reverse;
    overflow-y: auto;
    padding: 10px; /* เพิ่ม Padding เพื่อให้การ์ดไม่ติดขอบ */
    margin: 0;
    width: 100%;
    height: 100vh;
}
#card-container .card {
    display: flex;
    padding: 10px; /* ระยะห่างระหว่างการ์ด */
    /* background-color: bisque; */
    min-width: 100%; /* ขนาดขั้นต่ำของการ์ด */
    max-width: 5rem; /* ขนาดสูงสุดของการ์ด */
}

/* เพิ่มข้อมูลสำหรับรูปภาพ */
#card-container .card-img {
    width: 10rem;
    height: 14rem;
    overflow: hidden;
    border-radius: 0.5rem;

}

#card-container .card-img img {
    width: 100%;
    height: auto;
}
.list-user{
    padding-left: 100px;
}
/* ส่วนของข้อความที่แสดง */
.information h3{
    padding: 1rem;
    font-size: 1.2rem;
}
.information p{
    padding: 0.1rem 1rem;
    font-size: 1rem;
}
/* ปุ่มกดอนุมัติและไม่อนุมัติ */
.buttons{
    padding: 1rem;
}
.buttons .edit-btn,.delete-btn{
    font-size: 0.8rem;
    border-radius: 4px;
    height: 3rem;
    font-weight: 600;
    text-transform: uppercase;
    -webkit-transition: all 200ms linear;
    transition: all 200ms linear;
    padding: 0 30px;
    letter-spacing: 1px;
    display: -webkit-inline-flex;
    display: -ms-inline-flexbox;
    display: inline-flex;
    align-items: center;
    background-color: #ffeba7;
    color: #000000;
}

.buttons .edit-btn:hover,.delete-btn:hover{
    background-color: #000000;
    color: #ffeba7;
    box-shadow: 0 8px 24px 0 rgba(16, 39, 112, .2);
}
    </style>
</head>
<body>
    <!-- Sidebar Menu -->
    <div class="sidebar">
        <div class="profile">
            <!-- Change the src to the URL of the person icon -->
            <ion-icon name="person-outline"></ion-icon>
        </div>
        <ul class="menu">
            <span>Menu</span>
            <!-- <li>
                <a href="control.html">
                    <ion-icon name="home-outline"></ion-icon>
                    <p>Control</p>
                </a>
            </li> -->
            <li>
                <a href="add-event.html">
                    <ion-icon name="add-circle-outline"></ion-icon>
                    <p>Add Event</p>
                </a>
            </li>
           <!-- <li>
                <a href="notifications.html">
                    <ion-icon name="notifications-outline"></ion-icon>
                    <p>Notifications</p>
                </a>
            </li>  -->
            <li class="checkbox">
                <a href="user-permission.html">
                    <ion-icon name="checkbox-outline"></ion-icon>
                    <p>User Permission</p>
                </a>
            </li>
            <li class="data_user">
                <a href="data-user.html">
                    <ion-icon name="document-outline"></ion-icon>
                    <p>Data User</p>
                </a>
            </li>
            <li class="Chat">
                <a href="chat-user.html">
                    <ion-icon name="chatbox-outline"></ion-icon>
                    <p>Chat</p>
                </a>
            </li>
            <!-- <li class="switch-theme">
                <a href="#">
                    <ion-icon name="moon-outline"></ion-icon>
                    <p>Dark Mode</p>
                    <button>
                        <div class="circle"></div>
                    </button>
                </a>
            </li> -->
            <!-- <li>
                <a href="control.html">
                    <ion-icon name="headset-outline"></ion-icon>
                    <p>Contact admin</p>
                </a>
            </li> -->
            <li>
                <a href="logout.php">
                    <ion-icon name="log-out-outline"></ion-icon>
                    <p>Logout</p>
                </a>
            </li>
        </ul>
    </div>
    <!-- Ionicons -->
    <script
        type="module"
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script
        nomodule
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <!-- Add the script to use Ionicons through CDN -->
    <script
        type="module"
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script
        nomodule
        src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

        
    <h3 style="margin-left:120px; padding: 0.5rem; font-size: 1.3rem;">ข้อมูลผู้ใช้ทั้งหมด</h3>
    <section class="list-user" >
        <div class="card-container" id="card-container">
            <!-- การ์ดจะถูกสร้างโดย JavaScript -->
        </div>
    </section>


    
    <script>
document.addEventListener('DOMContentLoaded', function () {
    const cardContainer = document.getElementById('card-container');

    function fetchAndRenderData() {
        fetch('data-user.php')
            .then(response => response.json())
            .then(data => {
                // เคลียร์ข้อมูลที่มีอยู่ใน cardContainer
                cardContainer.innerHTML = '';
                data.forEach(item => {
                    const card = document.createElement('div');
                    card.classList.add('card');
                    card.innerHTML = `
                        <div class="card-img">
                            <img src="uploads/${item.image_path || "profile_none.png"}" alt="${item.user_name}">
                        </div>
                        <div class="information">
                            <h3>ID ${item.user_id} ชื่อบัญชี ${item.user_name} </h3>
                            <p>ข้อมูลส่วนตัว<p>
                            <p>ชื่อจริง <input type="text" name="firstname" value="${item.first_name}"> นามสกุล <input type="text" name="lastname"value="${item.last_name}"> อายุ ${item.age} เพศ ${item.gender} น้ำหนัก ${item.weight_us} ส่วนสูง ${item.height}<p>
                            <p>ชื่อบัญชี <input type="text" name="username" value="${item.user_name}"></p>
                            <p>ระหัสผ่าน <input type="text" name="userpasswd" value="${item.user_passwd}"></p>
                            <h3>สถานะตัวตน ${item.user_status}<h3>
                        <div>
                        <div class="buttons">
                            <button class="edit-btn" type="submit" name="">แก้ไข</button>
                            <button class="delete-btn">ลบบัญชีผู้ใช้</button>
                        </div>
                    `;
                    cardContainer.appendChild(card);
                    
                    const editBtn = card.querySelector('.edit-btn');
                    const deleteBtn = card.querySelector('.delete-btn');
                    
                    editBtn.addEventListener('click', function () {
                        if (confirm("คุณต้องการแก้ไขข้อมูล ใช่หรือไม่?")) {
                            const newFirstname = card.querySelector('input[name="firstname"]').value;
                            const newLastname = card.querySelector('input[name="lastname"]').value;
                            const newUsername = card.querySelector('input[name="username"]').value;
                            const newUserpasswd = card.querySelector('input[name="userpasswd"]').value; // แก้เป็น "userpasswd"
                            sendUserEdit(item.user_id, newFirstname, newLastname, newUsername, newUserpasswd);
                        } else {
                        // หากผู้ใช้กดยกเลิก ไม่ต้องทำอะไร
                        }
                    });

                    deleteBtn.addEventListener('click', function () { 
                        if (confirm("คุณต้องการลบหรือไม่?")) {
                            if (confirm("คุณแน่ใจนะว่าจะลบจริงๆ?")) {
                            // หากผู้ใช้กดตกลง ให้เปลี่ยนเส้นทางไปยัง index.html
                             // เรียกใช้ฟังก์ชันเพื่อลบไฟล์ภาพ
                                sendUserIDdelete(item.user_id, item.image_path);
                            // window.location.href = "index.html";
                            } else {
                            // หากผู้ใช้กดยกเลิก ไม่ต้องทำอะไร
                            }
                        } else {
                            // หากผู้ใช้กดยกเลิก ไม่ต้องทำอะไร
                        }
                    });
                });
            })
            .catch(error => console.error('Error:', error));
    }

    // เมื่อเริ่มต้นหน้าเว็บโดยใช้ DOMContentLoaded จะดึงและแสดงข้อมูล
    fetchAndRenderData();


    function sendUserEdit(userId, nFirstname, nLastname, nUsername, nUserasswd) {
        // ส่งข้อมูลไปยัง  พร้อมกับข้อความใหม่จาก textarea
        fetch(`data-user-update.php?userId=${userId}&firstName=${nFirstname}&lastName=${nLastname}&userName=${nUsername}&userPasswd=${nUserasswd}`, {
            method: 'GET'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
        })
        .then(data => {
            // หลังจากส่งข้อมูลไปยัง user-permission-allowed.php สามารถทำสิ่งที่ต้องการได้ตามความต้องการ
            console.log(data);
            // เมื่อคลิกที่ปุ่ม allowed ให้รีเฟรชหน้าเพื่อแสดงข้อมูลใหม่
            fetchAndRenderData();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function sendUserIDdelete(userId, imgUser) {
        fetch(`data-user-delete.php?user_id=${userId}&imgUser=${imgUser}`, {
            method: 'GET'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
        })
        .then(data => {
            // หลังจากส่งข้อมูลไปยัง user-permission-update.php สามารถทำสิ่งที่ต้องการได้ตามความต้องการ
            console.log(data);
            // เมื่อคลิกที่ปุ่ม allowed ให้รีเฟรชหน้าเพื่อแสดงข้อมูลใหม่
            fetchAndRenderData();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
});

    </script>
</body>
